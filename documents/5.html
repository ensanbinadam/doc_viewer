<!DOCTYPE html><html dir="rtl" lang="ar"><head><meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" /><title>Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ</title><link rel="preconnect" href="https://fonts.googleapis.com" /><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet" /><script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script><style>body { font-family: 'Tajawal', sans-serif; background-color: #f4f7f6; color: #333; margin: 0; padding: 15px; direction: rtl; line-height: 1.6; }input, button, textarea, select { font-family: 'Tajawal', sans-serif; }.container { max-width: 900px; margin: 0 auto; background-color: #fff; padding: 20px 30px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); width: 100%; box-sizing: border-box; }#worksheet-timer { text-align: center; font-size: 1.4em; font-weight: 700; color: #dc3545; background-color: #f8d7da; padding: 10px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #f5c6cb; }.header { display: flex; align-items: center; justify-content: space-between; border-bottom: 2px solid #eee; padding-bottom: 20px; margin-bottom: 30px; gap: 20px; }.header-logo img { max-width: 120px; max-height: 100px; object-fit: contain; }.header-main { text-align: center; flex-grow: 1; }.header-main h1 { margin: 0; color: #0056b3; font-size: 1.8em; line-height: 1.3; }.header-main p { margin: 5px 0 0; color: #555; font-size: 1.1em; }.question-block { margin-bottom: 30px; padding: 20px; border: 1px solid #e0e0e0; border-radius: 10px; background-color: #fdfdfd; overflow-wrap: break-word; }.question-header { font-size: 1.3em; font-weight: 700; color: #333; margin-bottom: 15px; }.question-block img, .mc-option img { max-width: 100%; height: auto; max-height: 300px; object-fit: contain; display: block; margin: 10px auto; border-radius: 8px; }.question-text, .reading-text { font-size: 1.15em; margin-bottom: 15px; }.options-container { display: flex; flex-direction: column; gap: 10px; }.mc-option { display: flex; align-items: center; gap: 10px; padding: 12px; border: 1px solid #ccc; border-radius: 8px; cursor: pointer; transition: background-color 0.2s; }.mc-option:hover { background-color: #f0f0f0; }.mc-option.selected { border-color: #007bff; background-color: #e7f3ff; }.mc-option input[type="radio"] { flex-shrink: 0; width: 18px; height: 18px; margin-left: 8px; }.fill-blank-input, .short-answer-input { width: 100%; padding: 12px; font-size: 1em; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; background-color: #fff; }.tf-option { display: inline-flex; align-items: center; gap: 8px; margin-left: 20px; padding: 5px; cursor: pointer; }.tf-option input[type="radio"] { width: 18px; height: 18px; }.classification-container { display: flex; flex-direction: column; gap: 20px; }.classification-groups { display: flex; flex-wrap: wrap; gap: 15px; justify-content: center; margin-bottom: 20px; }.group-box { flex: 1; min-width: 200px; background-color: #f8f9fa; border: 2px solid #0056b3; border-radius: 12px; padding: 10px; display: flex; flex-direction: column; }.group-header { background-color: #0056b3; color: white; padding: 8px; text-align: center; border-radius: 8px 8px 0 0; font-weight: bold; margin: -10px -10px 10px -10px; }.group-drop-zone { min-height: 100px; background-color: #fff; border: 2px dashed #ccc; border-radius: 8px; padding: 8px; display: flex; flex-wrap: wrap; gap: 8px; align-content: flex-start; transition: background-color 0.2s; }.group-drop-zone.over { background-color: #e3f2fd; border-color: #2196f3; }.classification-items { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; padding: 15px; background-color: #f1f1f1; border-radius: 12px; border: 1px solid #ddd; min-height: 60px; }.class-item { padding: 8px 15px; background-color: #fff; border: 1px solid #999; border-radius: 20px; cursor: grab; user-select: none; box-shadow: 0 2px 4px rgba(0,0,0,0.1); font-weight: 500; display: flex; align-items: center; gap: 5px; }.class-item img { max-height: 40px; margin: 0; }.class-item.dragging { opacity: 0.5; }.class-item.correct { background-color: #d4edda; border-color: #28a745; color: #155724; }.class-item.wrong { background-color: #f8d7da; border-color: #dc3545; color: #721c24; }.matching-container, .connecting-container { display: flex; flex-wrap: wrap; gap: 20px; justify-content: space-between; margin-bottom: 20px; }.matching-column, .column { flex: 1; min-width: 280px; display: flex; flex-direction: column; gap: 10px; }.matching-prompt-item { display: flex; flex-direction: column; gap: 10px; padding: 15px; background-color: #f8f9fa; border-radius: 8px; border: 1px solid #e0e0e0; }.prompt-content { text-align: center; font-weight: 600; }.drop-zone { min-height: 60px; border: 2px dashed #bbb; border-radius: 8px; background-color: #fff; transition: all 0.2s; display: flex; align-items: center; justify-content: center; padding: 5px; }.drop-zone.over { background-color: #e3f2fd; border-color: #2196f3; transform: scale(1.01); }.drop-zone.correct { border-color: #28a745; background-color: #d4edda; }.drop-zone.wrong { border-color: #dc3545; background-color: #f8d7da; }.answer-item, .ordering-item { width: 100%; box-sizing: border-box; padding: 12px; background-color: #fff; border: 1px solid #007bff; border-radius: 8px; cursor: grab; text-align: center; user-select: none; box-shadow: 0 2px 4px rgba(0,0,0,0.05); touch-action: none; }.answer-item:active, .ordering-item:active { cursor: grabbing; opacity: 0.8; }.answer-item img, .ordering-item img, .connect-item img { max-height: 80px; display: block; margin: 0 auto 5px; max-width: 100%; }.ordering-container { display: flex; flex-direction: column; gap: 10px; padding: 15px; border: 2px solid #eee; border-radius: 8px; min-height: 100px; }.ordering-item { display: flex; align-items: center; gap: 15px; border-color: #ccc; }.ordering-item::before { content: 'â˜°'; font-size: 1.4em; color: #999; cursor: grab; padding: 0 10px; }.ordering-container.correct { border-color: #28a745; background-color: #f0fff4; }.ordering-container.wrong { border-color: #dc3545; background-color: #fff5f5; }.connecting-container { position: relative; }.connection-svg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; }.connect-item { padding: 12px; border: 1px solid #ccc; border-radius: 6px; background-color: #fff; cursor: pointer; display: flex; align-items: center; gap: 10px; z-index: 2; min-height: 50px; }.connect-item.selected { border: 2px solid #007bff; background-color: #e7f3ff; }.connect-item.connect-correct { background-color: #e6f7ec; border-color: #28a745; }.connect-item.connect-wrong { background-color: #fdecea; border-color: #dc3545; }.action-button { display: block; width: 100%; max-width: 300px; margin: 40px auto 20px; padding: 15px 20px; font-size: 1.2em; font-weight: 700; color: #fff; background-color: #28a745; border: none; border-radius: 8px; cursor: pointer; transition: background-color 0.3s; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }.action-button:hover { background-color: #218838; }.result-panel { text-align: center; padding: 20px; margin-top: 30px; border-radius: 8px; }.result-panel.success { background-color: #d4edda; color: #155724; }.result-panel.failure { background-color: #f8d7da; color: #721c24; }.config-panel, .certificate-container { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 25px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); z-index: 1000; width: 90%; max-width: 600px; text-align: right; max-height: 90vh; overflow-y: auto; }.config-panel h3 { text-align: center; } .config-panel .form-group { margin-bottom: 1rem; } .config-panel .form-control { width: 100%; } .certificate-container { max-width: 800px; text-align: center; border: 10px solid #0056b3; background-color: #f0f8ff; box-sizing: border-box; padding: 15px; }.certificate-header { margin-bottom: 10px; display: flex; flex-direction: column; align-items: center; }.certificate-header img { max-width: 100px; max-height: 80px; object-fit: contain; }.certificate-title { font-size: 1.6em; color: #d4af37; margin: 5px 0; }.student-name { font-size: 1.5em; font-weight: bold; color: #0056b3; margin: 10px 0; word-break: break-word; }.achievement-text { font-size: 0.9em; margin: 5px 0; }.score-text { font-size: 1.1em; font-weight: bold; margin: 8px 0; }.teacher-name { font-size: 1em; margin-top: 10px; }.certificate-buttons { margin-top: 10px; display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; }.certificate-btn, .restart-btn { padding: 10px 20px; font-size: 1em; border-radius: 6px; border: none; cursor: pointer; }.certificate-btn { background-color: #007bff; color: #fff; }.restart-btn { background-color: #6c757d; color: #fff; margin: 10px 5px; }#worksheet-footer { text-align: center; margin-top: 20px; color: #6c757d; }#credits-footer { text-align: center; padding: 15px; font-size: 0.9em; color: #555; max-width: 900px; margin: 20px auto; background: #fff; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); } #credits-footer a { color: #0056b3; text-decoration: none; font-weight: bold; } #credits-footer a:hover { text-decoration: underline; }@media (max-width: 768px) { body { padding: 10px; }.container { padding: 15px; }.header { flex-direction: column; text-align: center; gap: 10px; }.header-logo img { max-width: 100px; margin: 0 auto; }.header-main h1 { font-size: 1.5em; }.question-header { font-size: 1.2em; }.matching-container, .connecting-container { flex-direction: column; }.matching-column, .column { width: 100%; min-width: unset; }.matching-container { display: flex; flex-direction: column; }.certificate-container { padding: 15px; border-width: 5px; }.certificate-title { font-size: 1.5em; }.student-name { font-size: 1.4em; }}@media print { body > *:not(.certificate-container-print-wrapper) { display: none !important; } body { margin: 0; padding: 0; background-color: #fff; } .certificate-container-print-wrapper { display: block !important; } .certificate-container-print-wrapper .certificate-container { display: block !important; box-shadow: none !important; border: 10px solid #0056b3 !important; width: 100% !important; max-width: 100% !important; margin: 0 !important; padding: 20px !important; box-sizing: border-box !important; position: static !important; transform: none !important; } .certificate-container .certificate-buttons { display: none !important; } }</style></head><body><div class="container"><header class="header"><div class="header-main"><h1 id="quizTitle">Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ</h1><p id="instructions">Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ù„ÙƒÙ„ Ø³Ø¤Ø§Ù„</p></div></header><main id="questions-container"></main><button id="check-answers-btn" class="action-button">ØªØµØ­ÙŠØ­ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª</button><div id="result-panel" class="result-panel" style="display: none;"></div><footer id="worksheet-footer"><p>Ø¥Ø¹Ø¯Ø§Ø¯ ÙˆØªØµÙ…ÙŠÙ… / Ù…Ù„ØªÙ‚Ù‰ Ù…Ø¹Ù„Ù…ÙŠ ÙˆÙ…Ø¹Ù„Ù…Ø§Øª Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø£Ø®Ø±Ù‰ Ù€ Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</p></footer></div><div class="config-panel" id="certificateForm"><h3>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©</h3><div class="form-group"><label for="studentNameInput">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨:</label><input class="form-control" id="studentNameInput" type="text" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨" /></div><div class="form-group"><label for="teacherNameInput">Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…:</label><input class="form-control" id="teacherNameInput" type="text" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…" value="Ù…Ø¹Ù„Ù… Ø§Ù„Ù…Ø§Ø¯Ø©" /></div><div class="form-group" style="display: flex; justify-content: center; gap: 15px;"><button class="certificate-btn" onclick="generateCertificate()" style="background: #28a745;">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©</button><button class="certificate-btn" onclick="closeCertificateForm()" style="background: #6c757d;">Ø¥Ù„ØºØ§Ø¡</button></div></div><div class="certificate-container" id="certificateContainer"><div class="certificate-header"><h2 class="certificate-quiz-title" id="certificateQuizTitle">Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ</h2></div><h1 class="certificate-title">Ø´Ù‡Ø§Ø¯Ø© Ø¥Ù†Ø¬Ø§Ø²</h1><div class="certificate-body" style="padding: 10px; margin: 10px 0; position: relative;"><div class="student-name" id="certificateStudentName"></div><div class="achievement-text">ØªÙ‡Ø§Ù†ÙŠÙ†Ø§! Ù„Ù‚Ø¯ Ø£ØªÙ…Ù…Øª ÙˆØ±Ù‚Ø© Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­</div><div class="score-text" id="certificateScoreText" style="color: #28a745;"></div><div class="achievement-text">Ù†Ø¸ÙŠØ± Ø¬Ù‡ÙˆØ¯Ùƒ Ø§Ù„Ù…ØªÙ…ÙŠØ²Ø©ØŒ Ù†Ù‚Ø¯Ù… Ù„Ùƒ Ù‡Ø°Ù‡ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© ØªÙ‚Ø¯ÙŠØ±Ù‹Ø§ Ù„Ø¥Ù†Ø¬Ø§Ø²Ùƒ.</div><div class="teacher-name" id="certificateTeacherName"></div></div><div class="certificate-footer"><p>Ø´Ù‡Ø§Ø¯Ø© Ù…Ø¹ØªÙ…Ø¯Ø© Ù…Ù† Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©</p></div><div class="certificate-buttons"><button class="certificate-btn" onclick="printCertificate()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button><button class="certificate-btn" onclick="downloadCertificate()">ğŸ“¥ Ø­ÙØ¸ ÙƒØµÙˆØ±Ø©</button><button class="certificate-btn" onclick="closeCertificate()">âœ• Ø¥ØºÙ„Ø§Ù‚</button></div></div><footer id="credits-footer"><p style="font-size: 0.9em; color: #4B5563; margin-bottom: 8px;"><a href="https://t.me/Interact2030" target="_blank" rel="noopener noreferrer" style="color: #4B5563;">Ø¨Ø±Ù…Ø¬Ø© Ùˆ ØªØµÙ…ÙŠÙ…/ Ù…Ù„ØªÙ‚Ù‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ Ø¨Ù…Ù„ØªÙ‚Ù‰ Ù…Ø¹Ù„Ù…ÙŠ ÙˆÙ…Ø¹Ù„Ù…Ø§Øª Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª Ù€ Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©.</a></p><p style="font-size: 0.8em; color: #6B7281;">ØªÙ…Øª Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… <a href="https://developers.google.com/studio" target="_blank" rel="noopener noreferrer">Google Studio</a> Ùˆ <a href="https://gemini.google.com/" target="_blank" rel="noopener noreferrer">Gemini</a> Ø¨ÙˆØ§Ø³Ø·Ø© <a href="https://t.me/Interact2030" target="_blank" rel="noopener noreferrer">Ù…Ù„ØªÙ‚Ù‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ</a>.</p></footer><script>
        const questionsData = [{"type":"multiple-choice","question":{"text":"<b><font size=\"4\" color=\"#a03232\">ÙŠØªÙ…ÙŠØ² Ø§Ù„Ø´ÙƒÙ„ Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ Ø¨Ø£Ù†Ù‡ Ù…ÙƒÙˆÙ† Ù…Ù†:</font></b>","image":null},"reading":{"text":"<div style=\"text-align: center;\"><b><font size=\"4\">ÙˆØ±Ù‚Ø© Ø¹Ù…Ù„ Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ø±Ù‚Ù…ÙŠØ© â€“ Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¯Ø³ Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ.</font></b></div><div style=\"text-align: center;\"><b><font size=\"4\" color=\"#325ad2\">Ø¹Ù†Ù€Ù€ÙˆØ§Ù† Ø§Ù„Ù€Ù€Ø¯Ø±Ø³: Ù…Ù‚Ø¯Ù…Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù†Ù…Ø°Ø¬Ø© Ø«Ù„Ø§Ø«ÙŠØ© Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯</font></b></div>","image":null,"audio":null},"feedback":"<article class=\"text-token-text-primary w-full focus:outline-none [--shadow-height:45px] has-data-writing-block:pointer-events-none has-data-writing-block:-mt-(--shadow-height) has-data-writing-block:pt-(--shadow-height) [&amp;:has([data-writing-block])&gt;*]:pointer-events-auto [content-visibility:auto] supports-[content-visibility:auto]:[contain-intrinsic-size:auto_100lvh] scroll-mt-[calc(var(--header-height)+min(200px,max(70px,20svh)))]\" tabindex=\"-1\" dir=\"auto\" data-turn-id=\"bc4c955a-443d-4de8-abb1-b52da780fdf0\" data-testid=\"conversation-turn-24\" data-scroll-anchor=\"true\" data-turn=\"assistant\"><div class=\"text-base my-auto mx-auto pb-10 [--thread-content-margin:--spacing(4)] thread-sm:[--thread-content-margin:--spacing(6)] thread-lg:[--thread-content-margin:--spacing(16)] px-(--thread-content-margin)\"><div class=\"[--thread-content-max-width:40rem] thread-lg:[--thread-content-max-width:48rem] mx-auto max-w-(--thread-content-max-width) flex-1 group/turn-messages focus-visible:outline-hidden relative flex w-full min-w-0 flex-col agent-turn\" tabindex=\"-1\"><div class=\"flex max-w-full flex-col grow\"><div data-message-author-role=\"assistant\" data-message-id=\"4c3b932a-c04e-49b8-8509-7dc2976acd4b\" dir=\"auto\" class=\"min-h-8 text-message relative flex w-full flex-col items-end gap-2 text-start break-words whitespace-normal [.text-message+&amp;]:mt-1\" data-message-model-slug=\"gpt-5-1\"><div class=\"flex w-full flex-col gap-1 empty:hidden first:pt-[1px]\"><div class=\"markdown prose dark:prose-invert w-full break-words light markdown-new-styling\"><h3 style=\"--tw-scale-x: 1; --tw-scale-y: 1; --tw-pan-x: ; --tw-pan-y: ; --tw-pinch-zoom: ; --tw-scroll-snap-strictness: proximity; --tw-gradient-from-position: ; --tw-gradient-via-position: ; --tw-gradient-to-position: ; --tw-ordinal: ; --tw-slashed-zero: ; --tw-numeric-figure: ; --tw-numeric-spacing: ; --tw-numeric-fraction: ; --tw-ring-inset: ; --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: rgb(59 130 246 / 0.5); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000; --tw-shadow: 0 0 #0000; --tw-shadow-colored: 0 0 #0000; --tw-blur: ; --tw-brightness: ; --tw-contrast: ; --tw-grayscale: ; --tw-hue-rotate: ; --tw-invert: ; --tw-saturate: ; --tw-sepia: ; --tw-drop-shadow: ; --tw-backdrop-blur: ; --tw-backdrop-brightness: ; --tw-backdrop-contrast: ; --tw-backdrop-grayscale: ; --tw-backdrop-hue-rotate: ; --tw-backdrop-invert: ; --tw-backdrop-opacity: ; --tw-backdrop-saturate: ; --tw-backdrop-sepia: ; --tw-contain-size: ; --tw-contain-layout: ; --tw-contain-paint: ; --tw-contain-style: ;\"><span style=\"--tw-scale-x: 1; --tw-scale-y: 1; --tw-pan-x: ; --tw-pan-y: ; --tw-pinch-zoom: ; --tw-scroll-snap-strictness: proximity; --tw-gradient-from-position: ; --tw-gradient-via-position: ; --tw-gradient-to-position: ; --tw-ordinal: ; --tw-slashed-zero: ; --tw-numeric-figure: ; --tw-numeric-spacing: ; --tw-numeric-fraction: ; --tw-ring-inset: ; --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: rgb(59 130 246 / 0.5); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000; --tw-shadow: 0 0 #0000; --tw-shadow-colored: 0 0 #0000; --tw-blur: ; --tw-brightness: ; --tw-contrast: ; --tw-grayscale: ; --tw-hue-rotate: ; --tw-invert: ; --tw-saturate: ; --tw-sepia: ; --tw-drop-shadow: ; --tw-backdrop-blur: ; --tw-backdrop-brightness: ; --tw-backdrop-contrast: ; --tw-backdrop-grayscale: ; --tw-backdrop-hue-rotate: ; --tw-backdrop-invert: ; --tw-backdrop-opacity: ; --tw-backdrop-saturate: ; --tw-backdrop-sepia: ; --tw-contain-size: ; --tw-contain-layout: ; --tw-contain-paint: ; --tw-contain-style: ; font-weight: bolder;\"><font size=\"4\" color=\"#32aa32\" style=\"--tw-scale-x: 1; --tw-scale-y: 1; --tw-pan-x: ; --tw-pan-y: ; --tw-pinch-zoom: ; --tw-scroll-snap-strictness: proximity; --tw-gradient-from-position: ; --tw-gradient-via-position: ; --tw-gradient-to-position: ; --tw-ordinal: ; --tw-slashed-zero: ; --tw-numeric-figure: ; --tw-numeric-spacing: ; --tw-numeric-fraction: ; --tw-ring-inset: ; --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: rgb(59 130 246 / 0.5); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000; --tw-shadow: 0 0 #0000; --tw-shadow-colored: 0 0 #0000; --tw-blur: ; --tw-brightness: ; --tw-contrast: ; --tw-grayscale: ; --tw-hue-rotate: ; --tw-invert: ; --tw-saturate: ; --tw-sepia: ; --tw-drop-shadow: ; --tw-backdrop-blur: ; --tw-backdrop-brightness: ; --tw-backdrop-contrast: ; --tw-backdrop-grayscale: ; --tw-backdrop-hue-rotate: ; --tw-backdrop-invert: ; --tw-backdrop-opacity: ; --tw-backdrop-saturate: ; --tw-backdrop-sepia: ; --tw-contain-size: ; --tw-contain-layout: ; --tw-contain-paint: ; --tw-contain-style: ;\">Ø¥ÙŠØ¶Ø§Ø­:</font></span></h3><h3 data-start=\"0\" data-end=\"16\"><b style=\"font-size: 1rem;\"><font size=\"4\">ÙŠØªÙ…ÙŠÙ‘Ø² Ø§Ù„Ø´ÙƒÙ„ Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ Ø¨Ø£Ù†Ù‡ Ù…ÙƒÙˆÙ‘Ù† Ù…Ù† <span data-start=\"58\" data-end=\"84\">Ø§Ù„Ø·ÙˆÙ„ ÙˆØ§Ù„Ø¹Ø±Ø¶ ÙˆØ§Ù„Ø§Ø±ØªÙØ§Ø¹.</span></font></b></h3></div></div></div></div></div></div></article>","options":[{"text":"Ø§Ù„Ø·ÙˆÙ„ ÙÙ‚Ø·","image":null},{"text":"Ø§Ù„Ø·ÙˆÙ„ ÙˆØ§Ù„Ø¹Ø±Ø¶","image":null},{"text":"Ø§Ù„Ø·ÙˆÙ„ ÙˆØ§Ù„Ø¹Ø±Ø¶ ÙˆØ§Ù„Ø§Ø±ØªÙØ§Ø¹","image":null},{"text":"","image":null}],"correct":0,"correctAnswer":"","pairs":[],"items":[],"groups":[]},{"type":"multiple-choice","question":{"text":"<b><font color=\"#9e3333\" size=\"4\">&nbsp;Ø¹Ù†Ø¯ ØªÙ†ÙÙŠØ° Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠØ© ØªÙƒÙˆÙ† Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ù„Ù€Ù€Ù€Ù€Ù€ :</font></b>","image":null},"reading":{"text":"<div style=\"text-align: center;\"><b><font size=\"4\">ÙˆØ±Ù‚Ø© Ø¹Ù…Ù„ Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ø±Ù‚Ù…ÙŠØ© â€“ Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¯Ø³ Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</font></b></div><div style=\"text-align: center;\"><b><font color=\"#325ad2\" size=\"4\">&nbsp;Ø¹Ù†Ù€Ù€ÙˆØ§Ù† Ø§Ù„Ù€Ù€Ø¯Ø±Ø³: ØªÙ†ÙÙŠØ° Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠØ©</font></b></div>","image":null,"audio":null},"feedback":"<article class=\"text-token-text-primary w-full focus:outline-none [--shadow-height:45px] has-data-writing-block:pointer-events-none has-data-writing-block:-mt-(--shadow-height) has-data-writing-block:pt-(--shadow-height) [&amp;:has([data-writing-block])&gt;*]:pointer-events-auto [content-visibility:auto] supports-[content-visibility:auto]:[contain-intrinsic-size:auto_100lvh] scroll-mt-[calc(var(--header-height)+min(200px,max(70px,20svh)))]\" tabindex=\"-1\" dir=\"auto\" data-turn-id=\"request-WEB:3018315d-3765-4802-a1cb-25119feb4fb5-13\" data-testid=\"conversation-turn-28\" data-scroll-anchor=\"true\" data-turn=\"assistant\"><div class=\"text-base my-auto mx-auto pb-10 [--thread-content-margin:--spacing(4)] thread-sm:[--thread-content-margin:--spacing(6)] thread-lg:[--thread-content-margin:--spacing(16)] px-(--thread-content-margin)\"><div class=\"[--thread-content-max-width:40rem] thread-lg:[--thread-content-max-width:48rem] mx-auto max-w-(--thread-content-max-width) flex-1 group/turn-messages focus-visible:outline-hidden relative flex w-full min-w-0 flex-col agent-turn\" tabindex=\"-1\"><div class=\"flex max-w-full flex-col grow\"><div data-message-author-role=\"assistant\" data-message-id=\"e6d6fcdb-55c7-429a-8dbb-4566954a5b02\" dir=\"auto\" class=\"min-h-8 text-message relative flex w-full flex-col items-end gap-2 text-start break-words whitespace-normal [.text-message+&amp;]:mt-1\" data-message-model-slug=\"gpt-5-1\"><div class=\"flex w-full flex-col gap-1 empty:hidden first:pt-[1px]\"><div class=\"markdown prose dark:prose-invert w-full break-words light markdown-new-styling\"><h3 style=\"--tw-scale-x: 1; --tw-scale-y: 1; --tw-pan-x: ; --tw-pan-y: ; --tw-pinch-zoom: ; --tw-scroll-snap-strictness: proximity; --tw-gradient-from-position: ; --tw-gradient-via-position: ; --tw-gradient-to-position: ; --tw-ordinal: ; --tw-slashed-zero: ; --tw-numeric-figure: ; --tw-numeric-spacing: ; --tw-numeric-fraction: ; --tw-ring-inset: ; --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: rgb(59 130 246 / 0.5); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000; --tw-shadow: 0 0 #0000; --tw-shadow-colored: 0 0 #0000; --tw-blur: ; --tw-brightness: ; --tw-contrast: ; --tw-grayscale: ; --tw-hue-rotate: ; --tw-invert: ; --tw-saturate: ; --tw-sepia: ; --tw-drop-shadow: ; --tw-backdrop-blur: ; --tw-backdrop-brightness: ; --tw-backdrop-contrast: ; --tw-backdrop-grayscale: ; --tw-backdrop-hue-rotate: ; --tw-backdrop-invert: ; --tw-backdrop-opacity: ; --tw-backdrop-saturate: ; --tw-backdrop-sepia: ; --tw-contain-size: ; --tw-contain-layout: ; --tw-contain-paint: ; --tw-contain-style: ;\"><span style=\"--tw-scale-x: 1; --tw-scale-y: 1; --tw-pan-x: ; --tw-pan-y: ; --tw-pinch-zoom: ; --tw-scroll-snap-strictness: proximity; --tw-gradient-from-position: ; --tw-gradient-via-position: ; --tw-gradient-to-position: ; --tw-ordinal: ; --tw-slashed-zero: ; --tw-numeric-figure: ; --tw-numeric-spacing: ; --tw-numeric-fraction: ; --tw-ring-inset: ; --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: rgb(59 130 246 / 0.5); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000; --tw-shadow: 0 0 #0000; --tw-shadow-colored: 0 0 #0000; --tw-blur: ; --tw-brightness: ; --tw-contrast: ; --tw-grayscale: ; --tw-hue-rotate: ; --tw-invert: ; --tw-saturate: ; --tw-sepia: ; --tw-drop-shadow: ; --tw-backdrop-blur: ; --tw-backdrop-brightness: ; --tw-backdrop-contrast: ; --tw-backdrop-grayscale: ; --tw-backdrop-hue-rotate: ; --tw-backdrop-invert: ; --tw-backdrop-opacity: ; --tw-backdrop-saturate: ; --tw-backdrop-sepia: ; --tw-contain-size: ; --tw-contain-layout: ; --tw-contain-paint: ; --tw-contain-style: ; font-weight: bolder;\"><font size=\"4\" color=\"#32aa32\" style=\"--tw-scale-x: 1; --tw-scale-y: 1; --tw-pan-x: ; --tw-pan-y: ; --tw-pinch-zoom: ; --tw-scroll-snap-strictness: proximity; --tw-gradient-from-position: ; --tw-gradient-via-position: ; --tw-gradient-to-position: ; --tw-ordinal: ; --tw-slashed-zero: ; --tw-numeric-figure: ; --tw-numeric-spacing: ; --tw-numeric-fraction: ; --tw-ring-inset: ; --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: rgb(59 130 246 / 0.5); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000; --tw-shadow: 0 0 #0000; --tw-shadow-colored: 0 0 #0000; --tw-blur: ; --tw-brightness: ; --tw-contrast: ; --tw-grayscale: ; --tw-hue-rotate: ; --tw-invert: ; --tw-saturate: ; --tw-sepia: ; --tw-drop-shadow: ; --tw-backdrop-blur: ; --tw-backdrop-brightness: ; --tw-backdrop-contrast: ; --tw-backdrop-grayscale: ; --tw-backdrop-hue-rotate: ; --tw-backdrop-invert: ; --tw-backdrop-opacity: ; --tw-backdrop-saturate: ; --tw-backdrop-sepia: ; --tw-contain-size: ; --tw-contain-layout: ; --tw-contain-paint: ; --tw-contain-style: ;\">Ø¥ÙŠØ¶Ø§Ø­:</font></span></h3><h3 style=\"--tw-scale-x: 1; --tw-scale-y: 1; --tw-pan-x: ; --tw-pan-y: ; --tw-pinch-zoom: ; --tw-scroll-snap-strictness: proximity; --tw-gradient-from-position: ; --tw-gradient-via-position: ; --tw-gradient-to-position: ; --tw-ordinal: ; --tw-slashed-zero: ; --tw-numeric-figure: ; --tw-numeric-spacing: ; --tw-numeric-fraction: ; --tw-ring-inset: ; --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: rgb(59 130 246 / 0.5); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000; --tw-shadow: 0 0 #0000; --tw-shadow-colored: 0 0 #0000; --tw-blur: ; --tw-brightness: ; --tw-contrast: ; --tw-grayscale: ; --tw-hue-rotate: ; --tw-invert: ; --tw-saturate: ; --tw-sepia: ; --tw-drop-shadow: ; --tw-backdrop-blur: ; --tw-backdrop-brightness: ; --tw-backdrop-contrast: ; --tw-backdrop-grayscale: ; --tw-backdrop-hue-rotate: ; --tw-backdrop-invert: ; --tw-backdrop-opacity: ; --tw-backdrop-saturate: ; --tw-backdrop-sepia: ; --tw-contain-size: ; --tw-contain-layout: ; --tw-contain-paint: ; --tw-contain-style: ;\"><b style=\"font-size: 1rem;\"><font size=\"4\">Ø¹Ù†Ø¯ ØªÙ†ÙÙŠØ° Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠØ© ØªÙƒÙˆÙ† Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ù„Ù€ Ø§Ù„Ø¶Ø±Ø¨ ÙˆØ§Ù„Ù‚Ø³Ù…Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø¬Ù…Ø¹ ÙˆØ§Ù„Ø·Ø±Ø­.</font></b></h3></div></div></div></div></div></div></article>","options":[{"text":"Ø§Ù„Ø¬Ù…Ø¹ ÙˆØ§Ù„Ø·Ø±Ø­","image":null},{"text":"Ø§Ù„Ø¶Ø±Ø¨","image":null},{"text":"Ø§Ù„Ø¶Ø±Ø¨ ÙˆØ§Ù„Ù‚Ø³Ù…Ø©","image":null},{"text":"","image":null}],"correct":0,"correctAnswer":"","pairs":[],"items":[],"groups":[]}];
        const NUMERAL_TYPE = "eastern";
        const PASS_PERCENTAGE = 80;
        let draggedElement = null;
        let timerInterval = null;
        const USE_TIMER = false;
        let selectedConnector = null;
        let connections = {};
        let finalScoreData = {};

        function formatNumber(num) {
            if (NUMERAL_TYPE === 'western') return num;
            return num.toString().replace(/\d/g, d => "Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©"[d]);
        }

        function formatText(html) {
            if (!html) return "";
            if (NUMERAL_TYPE === 'western') return html;
            const div = document.createElement('div');
            div.innerHTML = html;
            const walker = document.createTreeWalker(div, NodeFilter.SHOW_TEXT, null, false);
            let node;
            while (node = walker.nextNode()) {
                node.nodeValue = node.nodeValue.replace(/\d/g, d => "Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©"[d]);
            }
            return div.innerHTML;
        }

        function startWorksheetTimer() {
            if (!USE_TIMER) return;
            const timerElement = document.getElementById('worksheet-timer');
            if (!timerElement) return;
            timerElement.style.display = 'block';
            let duration = 20 * 60;

            timerInterval = setInterval(() => {
                const minutes = Math.floor(duration / 60);
                const seconds = duration % 60;
                timerElement.textContent = 'Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ' + formatNumber(minutes) + ':' + (seconds < 10 ? 'Ù ' : '') + formatNumber(seconds);
                
                if (--duration < 0) {
                    clearInterval(timerInterval);
                    alert('Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª! Ø³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©.');
                    location.reload();
                }
            }, 1000);
        }

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.ordering-item:not(.dragging)')];
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        function handleDragStart(e) {
            draggedElement = e.target;
            e.dataTransfer.effectAllowed = "move";
            e.dataTransfer.setData('text/plain', '');
            setTimeout(() => e.target.classList.add('dragging'), 0);
        }

        function handleDragEnd(e) {
            if(e.target) e.target.classList.remove('dragging');
            draggedElement = null;
            document.querySelectorAll('.drop-zone, .group-drop-zone').forEach(el => el.classList.remove('over'));
        }

        function handleDragOver(e) {
            e.preventDefault();
            const dropZone = e.target.closest('.drop-zone') || e.target.closest('.group-drop-zone');
            if (dropZone) {
                dropZone.classList.add('over');
            }
            const orderingContainer = e.target.closest('.ordering-container');
            if (orderingContainer && draggedElement && draggedElement.classList.contains('ordering-item')) {
                const afterElement = getDragAfterElement(orderingContainer, e.clientY);
                if (afterElement == null) {
                    orderingContainer.appendChild(draggedElement);
                } else {
                    orderingContainer.insertBefore(draggedElement, afterElement);
                }
            }
        }

        function handleDragLeave(e) {
              const dropZone = e.target.closest('.drop-zone') || e.target.closest('.group-drop-zone');
              if (dropZone) {
                  dropZone.classList.remove('over');
              }
        }

        function handleDrop(e) {
            e.preventDefault();
            const dropZone = e.target.closest('.drop-zone');
            const groupDropZone = e.target.closest('.group-drop-zone');

            if (dropZone && draggedElement && draggedElement.classList.contains('answer-item')) {
                dropZone.classList.remove('over');
                if (dropZone.children.length > 0) {
                      const existing = dropZone.firstElementChild;
                      const qBlock = dropZone.closest('.question-block');
                      const answersCol = qBlock.querySelector('.matching-column:last-child');
                      if(answersCol) answersCol.appendChild(existing);
                }
                dropZone.appendChild(draggedElement);
            } else if (groupDropZone && draggedElement && draggedElement.classList.contains('class-item')) {
                groupDropZone.classList.remove('over');
                groupDropZone.appendChild(draggedElement);
            }
        }

        function handleConnectorClick(e, qIndex) { const item = e.target.closest(".connect-item"); if (!item) return; if (!connections[qIndex]) connections[qIndex] = []; if (selectedConnector) { if (selectedConnector.dataset.column === item.dataset.column) return; const existingConnection = connections[qIndex].find(c => c.includes(selectedConnector.id) || c.includes(item.id)); if (existingConnection) return; const startElem = selectedConnector.dataset.column === "prompt" ? selectedConnector : item; const endElem = selectedConnector.dataset.column === "answer" ? selectedConnector : item; connections[qIndex].push([startElem.id, endElem.id]); drawConnections(qIndex); selectedConnector.classList.remove("selected"); selectedConnector = null; } else { const existingConnection = connections[qIndex].find(c => c.includes(item.id)); if (existingConnection) { connections[qIndex] = connections[qIndex].filter(c => !c.includes(item.id)); drawConnections(qIndex); } else { selectedConnector = item; item.classList.add("selected"); } } }
        function drawConnections(qIndex) { const svg = document.getElementById("connection-svg-" + qIndex); if (!svg) return; const container = svg.parentElement; svg.innerHTML = ""; if (!connections[qIndex]) return; connections[qIndex].forEach(conn => { const startElem = document.getElementById(conn[0]); const endElem = document.getElementById(conn[1]); if (!startElem || !endElem) return; const startRect = startElem.getBoundingClientRect(); const endRect = endElem.getBoundingClientRect(); const containerRect = container.getBoundingClientRect(); const x1 = startRect.left < endRect.left ? startRect.right - containerRect.left : startRect.left - containerRect.left; const y1 = startRect.top + startRect.height / 2 - containerRect.top; const x2 = startRect.left < endRect.left ? endRect.left - containerRect.left : endRect.right - containerRect.left; const y2 = endRect.top + endRect.height / 2 - containerRect.top; const line = document.createElementNS("http://www.w3.org/2000/svg", "line"); line.setAttribute("x1", x1); line.setAttribute("y1", y1); line.setAttribute("x2", x2); line.setAttribute("y2", y2); line.setAttribute("stroke", "#007bff"); line.setAttribute("stroke-width", "3"); svg.appendChild(line); }); }

        function renderQuestions() {
            const container = document.getElementById("questions-container");
            container.innerHTML = "";
            questionsData.forEach((q, index) => {
                const questionBlock = document.createElement("div");
                questionBlock.className = "question-block";
                questionBlock.id = "question-" + index;

                let content = '<div class="question-header">Ø§Ù„Ø³Ø¤Ø§Ù„ ' + formatNumber(index + 1) + '</div>';
                if (q.reading && (q.reading.text || q.reading.image)) {
                    content += '<div class="reading-text">';
                    if (q.reading.text) content += '<div>' + formatText(q.reading.text) + '</div>';
                    if (q.reading.image) content += '<img src="' + q.reading.image + '" alt="Ù†Øµ Ù‚Ø±Ø§Ø¦ÙŠ"> ';
                    if (q.reading.audio) content += '<audio src="' + q.reading.audio + '" controls style="margin-top: 10px; width: 100%;"></audio>';
                    content += '</div>';
                }
                content += '<div class="question-text">' + formatText(q.question.text);
                if (q.question.image) { content += '<img src="' + q.question.image + '" alt="ØµÙˆØ±Ø© Ø§Ù„Ø³Ø¤Ø§Ù„">'; }
                content += '</div><div class="options-container">';

                switch (q.type) {
                    case "multiple-choice":
                        q.options.forEach((opt, i) => {
                            content += '<label class="mc-option"><input type="radio" name="q' + index + '" value="' + i + '"><div class="mc-option-content">' + formatText(opt.text) + '</div>' + (opt.image ? '<img src="' + opt.image + '" alt="Ø®ÙŠØ§Ø±"> ' : "") + '</label>';
                        });
                        break;
                    case "true-false":
                        content += '<label class="tf-option"><input type="radio" name="q' + index + '" value="true"> ØµØ­</label><label class="tf-option"><input type="radio" name="q' + index + '" value="false"> Ø®Ø·Ø£</label>';
                        break;
                    case "fill-in-the-blank":
                        content += '<input type="text" class="fill-blank-input" placeholder="Ø§ÙƒØªØ¨ Ø¥Ø¬Ø§Ø¨ØªÙƒ Ù‡Ù†Ø§...">';
                        break;
                    case "short-answer":
                        content += '<textarea class="short-answer-input" rows="3" placeholder="Ø§ÙƒØªØ¨ Ø¥Ø¬Ø§Ø¨ØªÙƒ Ù‡Ù†Ø§..."></textarea>';
                        break;

                    case "ordering":
                        content += '<div class="ordering-container">';
                        const shuffledItems = [...q.items].map((item, originalIndex) => ({...item, originalIndex})).sort(() => Math.random() - 0.5);
                        shuffledItems.forEach((item) => {
                            content += '<div class="ordering-item" draggable="true" data-original-index="' + item.originalIndex + '">';
                            if(item.image) content += '<img src="' + item.image + '"> ';
                            if(item.text) content += '<span>' + formatText(item.text) + '</span>';
                            content += '</div>';
                        });
                        content += '</div>';
                        break;

                    case "matching":
                        content += '<div class="matching-container">';
                        content += '<div class="matching-column">';
                        q.pairs.forEach((p, i) => {
                            content += '<div class="matching-prompt-item">';
                            content += '<div class="prompt-content">';
                            if (p.prompt.image) content += '<img src="' + p.prompt.image + '">';
                            if (p.prompt.text) content += '<p>' + formatText(p.prompt.text) + '</p>';
                            content += '</div>';
                            content += '<div class="drop-zone" data-expected-index="' + i + '"></div>';
                            content += '</div>';
                        });
                        content += '</div>';
                        content += '<div class="matching-column">';
                        const answersWithIndex = q.pairs.map((p, i) => ({ content: p.answer, originalIndex: i }));
                        const shuffledAnswers = answersWithIndex.sort(() => Math.random() - 0.5);
                        shuffledAnswers.forEach(item => {
                            content += '<div class="answer-item" draggable="true" data-original-index="' + item.originalIndex + '">';
                            if (item.content.image) content += '<img src="' + item.content.image + '">';
                            if (item.content.text) content += '<p>' + formatText(item.content.text) + '</p>';
                            content += '</div>';
                        });
                        content += '</div>';
                        content += '</div>';
                        break;

                    case "connecting-lines":
                        const shuffledConnectAnswers = [...q.pairs].sort(() => Math.random() - 0.5);
                        content += '<div class="connecting-container" onclick="handleConnectorClick(event, ' + index + ')"><svg id="connection-svg-' + index + '" class="connection-svg"></svg><div class="column">' + q.pairs.map((p, i) => '<div class="connect-item" data-column="prompt" id="q' + index + '-prompt' + i + '" data-prompt-index="' + i + '">' + (p.prompt.image ? '<img src="' + p.prompt.image + '">' : "") + " " + formatText(p.prompt.text) + '</div>').join("") + '</div><div class="column">' + shuffledConnectAnswers.map((p, i) => { const originalPairIndex = q.pairs.findIndex(op => op.answer.text === p.answer.text && op.answer.image === p.answer.image); return '<div class="connect-item" data-column="answer" id="q' + index + '-answer' + i + '" data-answer-index="' + originalPairIndex + '">' + (p.answer.image ? '<img src="' + p.answer.image + '">' : "") + " " + formatText(p.answer.text) + '</div>'; }).join("") + '</div></div>';
                        break;

                    case "classification":
                        content += '<div class="classification-container">';

                        // 1. Render Groups (Buckets)
                        content += '<div class="classification-groups">';
                        q.groups.forEach(g => {
                            content += '<div class="group-box">';
                            content += '<div class="group-header">' + formatText(g.text) + '</div>';
                            // Group Body (Drop Zone)
                            content += '<div class="group-drop-zone" data-group-id="' + g.id + '"></div>';
                            content += '</div>';
                        });
                        content += '</div>';

                        // 2. Render Items (Draggable Pool)
                        content += '<div class="classification-items">';
                        const shuffledClassItems = [...q.items].sort(() => Math.random() - 0.5);
                        shuffledClassItems.forEach(item => {
                            content += '<div class="class-item" draggable="true" data-group-id="' + item.groupId + '">';
                            if (item.image) content += '<img src="' + item.image + '">';
                            if (item.text) content += '<span>' + formatText(item.text) + '</span>';
                            content += '</div>';
                        });
                        content += '</div>';

                        content += '</div>';
                        break;
                }
                content += '</div><div id="feedback-' + index + '" class="feedback" style="display:none;"></div>';
                questionBlock.innerHTML = content;
                container.appendChild(questionBlock);

                if (q.type === "matching") {
                    const answers = questionBlock.querySelectorAll('.answer-item');
                    answers.forEach(el => { el.addEventListener('dragstart', handleDragStart); el.addEventListener('dragend', handleDragEnd); });
                    const drops = questionBlock.querySelectorAll('.drop-zone');
                    drops.forEach(el => { el.addEventListener('dragover', handleDragOver); el.addEventListener('dragleave', handleDragLeave); el.addEventListener('drop', handleDrop); });
                }
                if (q.type === "ordering") {
                    const container = questionBlock.querySelector('.ordering-container');
                    container.addEventListener('dragover', handleDragOver);
                    const items = container.querySelectorAll('.ordering-item');
                    items.forEach(item => { item.addEventListener('dragstart', handleDragStart); item.addEventListener('dragend', handleDragEnd); });
                }
                if (q.type === "classification") {
                    const items = questionBlock.querySelectorAll('.class-item');
                    items.forEach(el => { el.addEventListener('dragstart', handleDragStart); el.addEventListener('dragend', handleDragEnd); });
                    const drops = questionBlock.querySelectorAll('.group-drop-zone');
                    drops.forEach(el => { el.addEventListener('dragover', handleDragOver); el.addEventListener('dragleave', handleDragLeave); el.addEventListener('drop', handleDrop); });

                    // Also allow dropping back to the pool
                    const pool = questionBlock.querySelector('.classification-items');
                    if(pool) {
                        pool.addEventListener('dragover', handleDragOver);
                        pool.addEventListener('drop', (e) => {
                            e.preventDefault();
                            const dragged = document.querySelector('.class-item.dragging');
                            if(dragged) {
                                pool.appendChild(dragged);
                            }
                        });
                    }
                }
            });
            document.getElementById("check-answers-btn").addEventListener("click", checkAnswers);
        }

        function checkAnswers() {
            let score = 0;
            questionsData.forEach((q, index) => {
                const questionBlock = document.getElementById("question-" + index);
                let isCorrect = false;
                let feedbackDiv = document.getElementById("feedback-" + index);

                switch (q.type) {
                    case "multiple-choice": const selectedOption = questionBlock.querySelector('input[name="q' + index + '"]:checked'); if (selectedOption && parseInt(selectedOption.value) === q.correct) { isCorrect = true; } break;
                    case "true-false": const selectedTF = questionBlock.querySelector('input[name="q' + index + '"]:checked'); if (selectedTF && (selectedTF.value === String(q.correctAnswer))) { isCorrect = true; } break;
                    case "fill-in-the-blank": const fitbInput = questionBlock.querySelector(".fill-blank-input").value.trim(); const correctAnswers = q.correctAnswer.split("|").map(a => a.trim()); if (correctAnswers.includes(fitbInput)) { isCorrect = true; } break;
                    case "short-answer": const saInput = questionBlock.querySelector(".short-answer-input").value.trim(); const correctSAAnswers = q.correctAnswer.split("|").map(a => a.trim()); if (correctSAAnswers.includes(saInput)) { isCorrect = true; } break;
                    case "ordering": const orderingContainer = questionBlock.querySelector(".ordering-container"); const currentItems = orderingContainer.querySelectorAll(".ordering-item"); const currentOrder = Array.from(currentItems).map(item => parseInt(item.dataset.originalIndex)); isCorrect = true; for (let i = 0; i < currentOrder.length; i++) { if (currentOrder[i] !== i) { isCorrect = false; break; } } if(isCorrect) { orderingContainer.classList.add('correct'); } else { orderingContainer.classList.add('wrong'); } break;
                    case "matching": const dropZones = questionBlock.querySelectorAll('.drop-zone'); let allMatchesCorrect = true; dropZones.forEach(zone => { const droppedItem = zone.querySelector('.answer-item'); const expectedIndex = parseInt(zone.dataset.expectedIndex); if (!droppedItem) { allMatchesCorrect = false; zone.classList.add('wrong'); } else { const actualIndex = parseInt(droppedItem.dataset.originalIndex); if (actualIndex === expectedIndex) { zone.classList.add('correct'); } else { allMatchesCorrect = false; zone.classList.add('wrong'); } droppedItem.draggable = false; } }); isCorrect = allMatchesCorrect; break;
                    case "connecting-lines": const userConnections = connections[index] || []; if (userConnections.length !== q.pairs.length) { isCorrect = false; break; } let connectCorrect = true; for (const conn of userConnections) { const promptElem = document.getElementById(conn[0]); const answerElem = document.getElementById(conn[1]); if (!promptElem || !answerElem) { connectCorrect = false; break; } if (promptElem.dataset.promptIndex !== answerElem.dataset.answerIndex) { connectCorrect = false; break; } } isCorrect = connectCorrect; break;
                    case "classification":
                        let allClassCorrect = true;
                        // Check if pool is empty (all items placed)
                        const pool = questionBlock.querySelector('.classification-items');
                        if (pool.children.length > 0) {
                            allClassCorrect = false;
                        }

                        // Check items in each group
                        const groups = questionBlock.querySelectorAll('.group-drop-zone');
                        groups.forEach(g => {
                            const targetGroupId = g.dataset.groupId;
                            const itemsInGroup = g.querySelectorAll('.class-item');

                            itemsInGroup.forEach(item => {
                                const itemGroupId = item.dataset.groupId;
                                if (itemGroupId === targetGroupId) {
                                    item.classList.add('correct');
                                } else {
                                    item.classList.add('wrong');
                                    allClassCorrect = false;
                                }
                                item.draggable = false; // Lock
                            });
                        });

                        // Also check if any group is missing items (simple count check or exact match)
                        // For strict correctness: All items must be placed and correctly.
                        isCorrect = allClassCorrect;
                        break;
                }
                if (isCorrect) { score++; if (q.feedback) { feedbackDiv.innerHTML = formatText(q.feedback); feedbackDiv.className = "feedback correct"; feedbackDiv.style.display = "block"; } } else { if (q.feedback) { feedbackDiv.innerHTML = formatText(q.feedback); feedbackDiv.className = "feedback incorrect"; feedbackDiv.style.display = "block"; } }
            });
            displayResult(score, questionsData.length);
        }

        function displayResult(score, total) { const resultPanel = document.getElementById("result-panel"); const percentage = total > 0 ? (score / total) * 100 : 0; let message = "<h2>Ù†ØªÙŠØ¬ØªÙƒ: " + formatNumber(score) + " Ù…Ù† " + formatNumber(total) + " (" + formatNumber(percentage.toFixed(0)) + "%)</h2>"; if (percentage >= PASS_PERCENTAGE) { resultPanel.className = "result-panel success"; message += '<p>Ù…Ù…ØªØ§Ø²! Ù„Ù‚Ø¯ Ø§Ø¬ØªØ²Øª ÙˆØ±Ù‚Ø© Ø§Ù„Ø¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­.</p><button id="certificateBtn" class="certificate-btn" onclick="openCertificateForm()">ğŸ† Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø´Ù‡Ø§Ø¯Ø© Ø¥Ù†Ø¬Ø§Ø²</button>'; } else { resultPanel.className = "result-panel failure"; message += "<p>Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø´Ù‡Ø§Ø¯Ø©ØŒ ÙŠØ¬Ø¨ ØªØ­Ù‚ÙŠÙ‚ " + formatNumber(PASS_PERCENTAGE) + "% Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰!</p>"; } message += '<button class="restart-btn" onclick="location.reload()">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</button>'; resultPanel.innerHTML = message; resultPanel.style.display = "block"; document.getElementById("check-answers-btn").style.display = "none"; }
        function openCertificateForm() { const score = document.querySelector(".result-panel h2").textContent; finalScoreData.scoreText = score; document.getElementById("certificateForm").style.display = "block"; }
        function closeCertificateForm() { document.getElementById("certificateForm").style.display = "none"; }
        function generateCertificate() { const studentName = document.getElementById("studentNameInput").value; const teacherName = document.getElementById("teacherNameInput").value; if (!studentName) { alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨."); return; } document.getElementById("certificateStudentName").innerText = studentName; document.getElementById("certificateTeacherName").innerText = "Ø§Ù„Ù…Ø¹Ù„Ù…: " + teacherName; document.getElementById("certificateScoreText").innerText = "Ø­Ù‚Ù‚Øª Ù†ØªÙŠØ¬Ø© " + finalScoreData.scoreText.replace('%', '') + '%'; closeCertificateForm(); document.getElementById("certificateContainer").style.display = "block"; }
        function closeCertificate() { document.getElementById("certificateContainer").style.display = "none"; }
        function printCertificate() { const cert = document.getElementById("certificateContainer"); const wrapper = document.createElement('div'); wrapper.className = 'certificate-container-print-wrapper'; wrapper.appendChild(cert.cloneNode(true)); document.body.appendChild(wrapper); window.print(); document.body.removeChild(wrapper); }
        function downloadCertificate() { 
            const certElement = document.getElementById("certificateContainer"); 
            const buttons = certElement.querySelector('.certificate-buttons');
            if (buttons) buttons.style.display = 'none';
            
            const originalStyles = { position: certElement.style.position, top: certElement.style.top, left: certElement.style.left, transform: certElement.style.transform, overflowY: certElement.style.overflowY }; 
            certElement.style.position = 'absolute'; certElement.style.top = '0px'; certElement.style.left = '0px'; certElement.style.transform = 'none'; certElement.style.overflowY = 'visible';
            
            html2canvas(certElement, { scale: 2, useCORS: true, logging: false, scrollY: -window.scrollY }).then(canvas => { 
                const link = document.createElement("a"); link.download = "certificate.png"; link.href = canvas.toDataURL("image/png"); link.click(); 
            }).finally(() => { 
                certElement.style.position = originalStyles.position; certElement.style.top = originalStyles.top; certElement.style.left = originalStyles.left; certElement.style.transform = originalStyles.transform; certElement.style.overflowY = originalStyles.overflowY;
                if (buttons) buttons.style.display = 'flex';
            }); 
        }

        window.openCertificateForm = openCertificateForm;
        window.closeCertificateForm = closeCertificateForm;
        window.generateCertificate = generateCertificate;
        window.closeCertificate = closeCertificate;
        window.printCertificate = printCertificate;
        window.downloadCertificate = downloadCertificate;
        window.handleConnectorClick = handleConnectorClick;
        
        document.addEventListener("DOMContentLoaded", () => { 
            renderQuestions(); 
            startWorksheetTimer();
        });
      </script></body></html>