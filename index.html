<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ø£Ø¯Ø§Ø© Ø¥Ø¹Ø¯Ø§Ø¯ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
        href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap"
        rel="stylesheet"
    />
    <style>
        body { font-family: "Cairo", sans-serif; background-color: #f0f2f5; color: #333; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { background-color: white; padding: 25px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); width: 90%; max-width: 1200px; display: grid; grid-template-columns: 1fr 2fr; grid-template-rows: auto 1fr; gap: 20px; grid-template-areas: "header header" "sidebar main"; }
        header { grid-area: header; text-align: center; border-bottom: 1px solid #eee; padding-bottom: 20px; }
        header h1 { margin: 0; color: #2c3e50; }
        .sidebar { grid-area: sidebar; display: flex; flex-direction: column; gap: 15px; }
        .main-content { grid-area: main; display: flex; flex-direction: column; }
        button { background-color: #3498db; color: white; border: none; padding: 12px 20px; border-radius: 5px; cursor: pointer; font-size: 1.1em; font-family: "Cairo", sans-serif; transition: background-color 0.3s; }
        button:hover { background-color: #2980b9; }
        #export-json-btn { background-color: #2ecc71; }
        #export-json-btn:hover { background-color: #27ae60; }
        #file-list { list-style-type: none; padding: 0; margin: 0; border: 1px solid #ddd; border-radius: 5px; background-color: #f9f9f9; overflow-y: auto; height: 300px; }
        #file-list li { padding: 10px; cursor: pointer; border-bottom: 1px solid #eee; }
        #file-list li:hover { background-color: #e9e9e9; }
        #json-output { width: 100%; height: 200px; font-family: monospace; font-size: 1em; border: 1px solid #ddd; border-radius: 5px; padding: 10px; direction: ltr; resize: vertical; }
        #preview { flex-grow: 1; border: 1px solid #ddd; border-radius: 5px; display: flex; justify-content: center; align-items: center; background-color: #f9f9f9; min-height: 400px; }
        #preview-iframe { width: 100%; height: 100%; border: none; }
        .info { color: #7f8c8d; text-align: center; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Ø£Ø¯Ø§Ø© Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ù„Ù `file-list.json`</h1>
            <p class="info">ØªØ¹Ù…Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø¯Ø§Ø© Ù…Ø­Ù„ÙŠØ§Ù‹ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ Ù„Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª.</p>
        </header>

        <aside class="sidebar">
            <button id="select-folder-btn">â‘  Ø§Ø®ØªØ± Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª</button>
            <h4>Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„ØªÙŠ ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„ÙŠÙ‡Ø§:</h4>
            <ul id="file-list"><li class="info">...ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø¬Ù„Ø¯</li></ul>
            <h4>â‘¡ Ù…Ø­ØªÙˆÙ‰ JSON:</h4>
            <textarea id="json-output" readonly>Ø³ÙŠØ¸Ù‡Ø± Ø§Ù„ÙƒÙˆØ¯ Ù‡Ù†Ø§...</textarea>
            
            <button id="export-json-btn" disabled>â‘¢ ØªØµØ¯ÙŠØ± Ù…Ù„Ù file-list.json</button>
        </aside>

        <main class="main-content">
            <h4>Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø£Ùˆ Ø§Ù„ÙØªØ­:</h4>
            <div id="preview"><p class="info">Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ù…Ù„Ù Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ù…Ø¹Ø§ÙŠÙ†ØªÙ‡ (PDF) Ø£Ùˆ Ù„ÙØªØ­Ù‡ ÙÙŠ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„Ù…Ø®ØµØµ Ù„Ù‡ (Office)</p></div>
        </main>
    </div>

    <script>
        const selectFolderBtn = document.getElementById("select-folder-btn");
        const fileListElement = document.getElementById("file-list");
        const jsonOutput = document.getElementById("json-output");
        const exportJsonBtn = document.getElementById("export-json-btn"); // ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ØªØºÙŠØ±
        const previewElement = document.getElementById("preview");
        let fileHandles = new Map();

        selectFolderBtn.addEventListener("click", async () => {
            if (!("showDirectoryPicker" in window)) {
                alert("Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø©. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø³ØªØ®Ø¯Ø§Ù… Google Chrome Ø£Ùˆ Microsoft Edge.");
                return;
            }
            try {
                const dirHandle = await window.showDirectoryPicker();
                const fileNames = [];
                fileHandles.clear();
                fileListElement.innerHTML = "";
                for await (const entry of dirHandle.values()) {
                    if (entry.kind === "file" && !entry.name.startsWith(".")) {
                        fileNames.push(entry.name);
                        fileHandles.set(entry.name, entry);
                        const li = document.createElement("li");
                        li.textContent = entry.name;
                        li.addEventListener("click", () => displayLocalFile(entry.name));
                        fileListElement.appendChild(li);
                    }
                }
                fileNames.sort();
                jsonOutput.value = JSON.stringify(fileNames, null, 2);
                
                // ØªÙØ¹ÙŠÙ„ Ø²Ø± Ø§Ù„ØªØµØ¯ÙŠØ± Ø¨Ø¹Ø¯ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
                exportJsonBtn.disabled = false;

                if (fileNames.length === 0) {
                    fileListElement.innerHTML = '<li class="info">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ù„ÙØ§Øª.</li>';
                    exportJsonBtn.disabled = true; // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø²Ø± Ø¥Ø°Ø§ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª
                }
            } catch (err) {
                if (err.name !== "AbortError") console.error(err);
            }
        });
        
        // --- Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù„ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ù„Ù ---
        function exportJsonFile() {
            const jsonData = jsonOutput.value;
            if (!jsonData || jsonData === 'Ø³ÙŠØ¸Ù‡Ø± Ø§Ù„ÙƒÙˆØ¯ Ù‡Ù†Ø§...') {
                alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø­ØªÙˆÙ‰ Ù„ØªØµØ¯ÙŠØ±Ù‡. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø£ÙˆÙ„Ø§Ù‹.');
                return;
            }

            // Ø¥Ù†Ø´Ø§Ø¡ ÙƒØ§Ø¦Ù† Blob Ù…Ù† Ø§Ù„Ù†Øµ
            const blob = new Blob([jsonData], { type: 'application/json' });
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· ÙˆÙ‡Ù…ÙŠ Ù„ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ù…Ù„Ù
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'file-list.json'; // Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø°ÙŠ Ø³ÙŠØªÙ… ØªÙ†Ø²ÙŠÙ„Ù‡
            document.body.appendChild(a);
            a.click();
            
            // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø±Ø§Ø¨Ø· Ø¨Ø¹Ø¯ Ø§Ù„ØªÙ†Ø²ÙŠÙ„
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // --- Ø±Ø¨Ø· Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø¨Ø§Ù„Ø²Ø± ---
        exportJsonBtn.addEventListener("click", exportJsonFile);

        async function displayLocalFile(fileName) {
            const fileHandle = fileHandles.get(fileName);
            if (!fileHandle) return;
            const file = await fileHandle.getFile();
            const fileExtension = fileName.split(".").pop().toLowerCase();

            if (fileExtension === "pdf") {
                previewElement.innerHTML = "";
                const objectURL = URL.createObjectURL(file);
                const iframe = document.createElement("iframe");
                iframe.id = "preview-iframe";
                iframe.src = objectURL;
                previewElement.appendChild(iframe);
            } else if (["docx", "pptx", "xlsx", "doc", "ppt", "xls"].includes(fileExtension)) {
                const objectURL = URL.createObjectURL(file);
                const tempLink = document.createElement("a");
                tempLink.href = objectURL;
                tempLink.download = fileName;
                document.body.appendChild(tempLink);
                tempLink.click();
                document.body.removeChild(tempLink);
                URL.revokeObjectURL(objectURL);
                previewElement.innerHTML = `<p class="info">ğŸ‘<br>ØªÙ… Ø¨Ø¯Ø¡ ØªÙ†Ø²ÙŠÙ„ Ù…Ù„Ù '${fileName}'.<br>Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù„Ù ÙÙŠ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ø²ÙŠÙ„Ø§Øª Ù„ÙØªØ­Ù‡.</p>`;
            } else {
                previewElement.innerHTML = `<p class="info">Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù (${fileExtension}) ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… Ù„Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø£Ùˆ Ø§Ù„ÙØªØ­ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±.</p>`;
            }
        }
    </script>
</body>
</html>
