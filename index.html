<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø°ÙƒÙŠ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Almarai:wght@300;400;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #1e293b; --accent: #c5a059; --bg: #f8fafc;
            --panel: #ffffff; --border: #e2e8f0; --text: #334155;
            --hover: #f1f5f9; --shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
        }
        body.dark-mode {
            --primary: #0f172a; --bg: #0f172a; --panel: #1e293b;
            --border: #334155; --text: #f1f5f9; --hover: #334155;
        }
        body { font-family: 'Almarai', sans-serif; margin: 0; background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; display: flex; transition: 0.3s; }
        
        /* Sidebar Styles */
        aside { width: 350px; background: var(--panel); border-left: 1px solid var(--border); display: flex; flex-direction: column; height: 100%; box-shadow: var(--shadow); z-index: 10; transition: 0.3s; }
        .sidebar-header { padding: 20px; background: var(--primary); color: white; text-align: center; border-bottom: 4px solid var(--accent); }
        .sidebar-header h2 { margin: 0; font-size: 1.1rem; }
        
        .controls { padding: 15px; display: flex; flex-direction: column; gap: 10px; border-bottom: 1px solid var(--border); }
        .btn { padding: 10px; border: none; border-radius: 8px; cursor: pointer; font-family: inherit; font-weight: bold; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-primary { background: var(--accent); color: white; }
        .btn-primary:hover { filter: brightness(1.1); }
        .btn-danger { background: #ef4444; color: white; }
        .input-box { padding: 10px; border-radius: 8px; border: 1px solid var(--border); background: var(--bg); color: var(--text); width: 100%; box-sizing: border-box; }

        /* File Tree Styles */
        .file-tree { flex: 1; overflow-y: auto; padding: 10px; }
        .folder-group { margin-bottom: 5px; }
        .folder-header { 
            padding: 12px; background: var(--hover); border-radius: 8px; cursor: pointer; 
            display: flex; justify-content: space-between; align-items: center; font-weight: bold;
            border: 1px solid var(--border); margin-bottom: 5px;
        }
        .folder-header:hover { background: rgba(197, 160, 89, 0.1); color: var(--accent); }
        .folder-content { display: none; padding-right: 15px; border-right: 2px solid var(--border); margin-right: 10px; animation: slideDown 0.3s ease; }
        .folder-content.open { display: block; }
        
        .file-item { 
            padding: 8px 10px; border-bottom: 1px solid var(--border); cursor: pointer; 
            display: flex; align-items: center; gap: 10px; transition: 0.2s; font-size: 0.9rem;
        }
        .file-item:hover { background: var(--hover); padding-right: 15px; }
        .file-item.active { background: rgba(197, 160, 89, 0.1); border-right: 3px solid var(--accent); }
        .file-actions { margin-right: auto; opacity: 0; transition: 0.2s; display: flex; gap: 8px; }
        .file-item:hover .file-actions { opacity: 1; }
        .action-icon { cursor: pointer; font-size: 0.9rem; }
        .action-icon:hover { transform: scale(1.2); }

        /* Main Viewer Styles */
        main { flex: 1; display: flex; flex-direction: column; background: var(--bg); padding: 20px; }
        .viewer-container { flex: 1; background: var(--panel); border-radius: 15px; border: 1px solid var(--border); overflow: hidden; position: relative; box-shadow: var(--shadow); }
        iframe, video, img { width: 100%; height: 100%; border: none; object-fit: contain; }
        .empty-state { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: #94a3b8; }

        /* Modals */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; backdrop-filter: blur(5px); }
        .modal-content { background: var(--panel); width: 90%; max-width: 400px; margin: 10vh auto; padding: 25px; border-radius: 15px; text-align: center; animation: zoomIn 0.3s; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); }
        
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes zoomIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        
        /* Mobile */
        @media (max-width: 768px) { body { flex-direction: column; } aside { width: 100%; height: 50vh; } }
    </style>
</head>
<body>

    <div id="authModal" class="modal" style="display: flex;">
        <div class="modal-content">
            <i class="fa-solid fa-shield-halved fa-3x" style="color: var(--accent); margin-bottom: 20px;"></i>
            <h3>Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†</h3>
            <p>ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…ÙØªØ§Ø­ Ø§Ù„Ù…Ø±ÙˆØ± (Token) Ù„Ù„ÙˆØµÙˆÙ„</p>
            <input type="password" id="authTokenInput" class="input-box" placeholder="github_pat_..." style="text-align: center;">
            <div style="margin-top: 20px; display: flex; gap: 10px;">
                <button class="btn btn-primary" style="flex: 1;" onclick="saveToken()">Ø¯Ø®ÙˆÙ„</button>
            </div>
            <p style="font-size: 0.8rem; color: #94a3b8; margin-top: 15px;">ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„Ø±Ù…Ø² ÙÙŠ Ù…ØªØµÙØ­Ùƒ ÙÙ‚Ø·</p>
        </div>
    </div>

    <div id="loadingModal" class="modal"><div class="modal-content"><i class="fas fa-spinner fa-spin fa-2x"></i><h3 id="loadingText">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¹Ù…Ù„...</h3></div></div>
    
    <div id="renameModal" class="modal"><div class="modal-content">
        <h3>ØªØºÙŠÙŠØ± Ø§Ù„Ø§Ø³Ù…</h3>
        <input id="renameInput" class="input-box">
        <div style="margin-top:15px; display:flex; gap:10px;">
            <button onclick="confirmRename()" class="btn btn-primary" style="flex:1">Ø­ÙØ¸</button>
            <button onclick="closeModal('renameModal')" class="btn" style="flex:1">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
    </div></div>

    <div class="container" style="display: flex; width: 100%; height: 100%;">
        <aside>
            <div class="sidebar-header">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h2>ğŸ“‚ Ø¥Ø¯Ø§Ø±Ø© Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</h2>
                    <i class="fa-solid fa-moon" style="cursor: pointer;" onclick="toggleTheme()"></i>
                </div>
                <small style="opacity: 0.8;">ØªØ­ÙÙŠØ¸ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø¨Ø§Ù„Ø¨Ø¬Ø§Ø¯ÙŠØ©</small>
            </div>
            
            <div class="controls">
                <input type="file" id="fileInput" hidden onchange="handleFileUpload(this)">
                <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
                    <i class="fa-solid fa-cloud-arrow-up"></i> Ø±ÙØ¹ Ù…Ù„Ù Ø¬Ø¯ÙŠØ¯
                </button>
                <input type="text" class="input-box" placeholder="ğŸ” Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ù„ÙØ§Øª..." oninput="filterFiles(this.value)">
                <div style="display: flex; gap: 5px;">
                     <button class="btn" style="flex:1; font-size:0.8rem" onclick="logout()"><i class="fa-solid fa-sign-out"></i> Ø®Ø±ÙˆØ¬</button>
                     <button class="btn" style="flex:1; font-size:0.8rem" onclick="refreshFiles()"><i class="fa-solid fa-rotate"></i> ØªØ­Ø¯ÙŠØ«</button>
                </div>
            </div>

            <div id="fileTree" class="file-tree">
                </div>
        </aside>

        <main>
            <div style="display: flex; justify-content: space-between; margin-bottom: 10px; align-items: center;">
                <h3 id="viewerTitle" style="margin: 0;">Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù</h3>
                <a id="downloadBtn" href="#" target="_blank" class="btn btn-primary" style="display: none; padding: 5px 15px; font-size: 0.9rem;">
                    <i class="fa-solid fa-download"></i> ØªØ­Ù…ÙŠÙ„
                </a>
            </div>
            <div id="viewer" class="viewer-container">
                <div class="empty-state">
                    <i class="fa-regular fa-folder-open fa-5x"></i>
                    <p>Ø§Ø®ØªØ± Ù…Ù„ÙØ§Ù‹ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© Ù„Ù„Ù…Ø¹Ø§ÙŠÙ†Ù€Ø©</p>
                </div>
            </div>
        </main>
    </div>

    <script>
        // --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø¯Ø±Ø³Ø© ---
        const CONFIG = {
            username: 'ensanbinadam', // Ø§Ø³Ù… Ø­Ø³Ø§Ø¨ GitHub
            repo: 'doc_viewer',       // Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹
            branch: 'main',        // Ø§Ù„ÙØ±Ø¹
            path: 'documents'          // Ø§Ù„Ù…Ø¬Ù„Ø¯ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹
        };

        // --- Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© ---
        let allFiles = [];
        let currentFile = null;

        // --- Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø¯Ø¡ ---
        document.addEventListener("DOMContentLoaded", () => {
            if(localStorage.getItem('github_token')) {
                document.getElementById('authModal').style.display = 'none';
                fetchFiles();
            }
            if(localStorage.getItem('theme') === 'dark') document.body.classList.add('dark-mode');
        });

        // --- Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© ÙˆØ§Ù„Ø£Ù…Ø§Ù† ---
        function saveToken() {
            const token = document.getElementById('authTokenInput').value.trim();
            if(token) {
                localStorage.setItem('github_token', token);
                document.getElementById('authModal').style.display = 'none';
                fetchFiles();
            } else {
                alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù…Ø²");
            }
        }

        function logout() {
            localStorage.removeItem('github_token');
            location.reload();
        }

        function getAuthHeader() {
            return { 
                'Authorization': `token ${localStorage.getItem('github_token')}`,
                'Accept': 'application/vnd.github.v3+json'
            };
        }

        // --- Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ---
        async function fetchFiles() {
            const treeDiv = document.getElementById('fileTree');
            treeDiv.innerHTML = '<div style="text-align:center; padding:20px;"><i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>';
            
            try {
                const url = `https://api.github.com/repos/${CONFIG.username}/${CONFIG.repo}/contents/${CONFIG.path}`;
                const res = await fetch(url, { headers: getAuthHeader() });
                
                if(!res.ok) throw new Error("ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„: ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ");
                
                const data = await res.json();
                allFiles = Array.isArray(data) ? data : [];
                renderTree(allFiles);
            } catch (err) {
                treeDiv.innerHTML = `<div style="color:red; text-align:center;">${err.message}<br><button class="btn" onclick="logout()">Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù…Ø²</button></div>`;
            }
        }

        // --- Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù„ÙØ§Øª ÙˆØ§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª ---
        function parseFileName(name) {
            // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù„Ø¯ Ù…Ù† Ø§Ù„Ø£Ù‚ÙˆØ§Ø³ Ø§Ù„Ù…Ø±Ø¨Ø¹Ø© [folder]
            const match = name.match(/^\[(.*?)\]\s*(.*)/);
            if (match) return { folder: match[1], cleanName: match[2], fullName: name };
            return { folder: 'Ù…Ù„ÙØ§Øª Ø¹Ø§Ù…Ø©', cleanName: name, fullName: name };
        }

        function renderTree(files, filterText = '') {
            const treeDiv = document.getElementById('fileTree');
            treeDiv.innerHTML = '';
            
            // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª ÙÙŠ Ù…Ø¬Ù„Ø¯Ø§Øª
            const folders = {};
            
            files.forEach(file => {
                if(filterText && !file.name.toLowerCase().includes(filterText.toLowerCase())) return;
                
                const info = parseFileName(file.name);
                if (!folders[info.folder]) folders[info.folder] = [];
                folders[info.folder].push({ ...file, ...info });
            });

            // ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª ÙˆØ¹Ø±Ø¶Ù‡Ø§
            Object.keys(folders).sort().forEach(folderName => {
                const group = document.createElement('div');
                group.className = 'folder-group';
                
                const header = document.createElement('div');
                header.className = 'folder-header';
                header.innerHTML = `<span><i class="fa-solid fa-folder" style="color:#fbbf24; margin-left:10px;"></i> ${folderName}</span> <span style="font-size:0.8em; opacity:0.6">${folders[folderName].length}</span>`;
                header.onclick = () => {
                    const content = header.nextElementSibling;
                    content.classList.toggle('open');
                    header.querySelector('.fa-folder').classList.toggle('fa-folder-open');
                };

                const content = document.createElement('div');
                content.className = 'folder-content';
                // ÙØªØ­ Ø§Ù„Ù…Ø¬Ù„Ø¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø­Ø«
                if(filterText) content.classList.add('open');

                folders[folderName].forEach(file => {
                    const item = document.createElement('div');
                    item.className = 'file-item';
                    item.innerHTML = `
                        <i class="${getFileIcon(file.name)}"></i>
                        <span style="flex:1; overflow:hidden; text-overflow:ellipsis;">${file.cleanName}</span>
                        <div class="file-actions">
                            <i class="fa-solid fa-pen action-icon" style="color:var(--accent)" title="ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ø³Ù…" onclick="openRename('${file.fullName}', '${file.sha}')"></i>
                            <i class="fa-solid fa-trash action-icon" style="color:#ef4444" title="Ø­Ø°Ù" onclick="deleteFile('${file.fullName}', '${file.sha}')"></i>
                        </div>
                    `;
                    item.onclick = (e) => {
                        // Ù…Ù†Ø¹ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­Ø°Ù/Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
                        if(e.target.classList.contains('action-icon')) return;
                        loadViewer(file);
                        document.querySelectorAll('.file-item').forEach(i => i.classList.remove('active'));
                        item.classList.add('active');
                    };
                    content.appendChild(item);
                });

                group.appendChild(header);
                group.appendChild(content);
                treeDiv.appendChild(group);
            });
        }

        // --- Ø§Ù„Ø¹Ø§Ø±Ø¶ (Viewer) ---
        function loadViewer(file) {
            const viewer = document.getElementById('viewer');
            const title = document.getElementById('viewerTitle');
            const dlBtn = document.getElementById('downloadBtn');
            const ext = file.name.split('.').pop().toLowerCase();
            const url = file.download_url;

            title.innerText = parseFileName(file.name).cleanName;
            dlBtn.href = url;
            dlBtn.style.display = 'inline-flex';
            
            viewer.innerHTML = '<div class="empty-state"><i class="fas fa-spinner fa-spin fa-3x"></i></div>';

            let content = '';
            // ØµÙˆØ±
            if(['jpg','jpeg','png','gif','svg'].includes(ext)) {
                content = `<img src="${url}">`;
            }
            // ÙÙŠØ¯ÙŠÙˆ ÙˆØµÙˆØª
            else if(['mp4','webm'].includes(ext)) {
                content = `<video controls src="${url}" style="width:100%; height:100%"></video>`;
            }
            // Ù…Ù„ÙØ§Øª Ø£ÙˆÙÙŠØ³ (Word, Excel, PPT) - Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¹Ø§Ø±Ø¶ Ù…Ø§ÙŠÙƒØ±ÙˆØ³ÙˆÙØª
            else if(['docx','xlsx','pptx','doc','xls','ppt'].includes(ext)) {
                content = `<iframe src="https://view.officeapps.live.com/op/embed.aspx?src=${encodeURIComponent(url)}"></iframe>`;
            }
            // PDF ÙˆÙ…Ù„ÙØ§Øª Ø£Ø®Ø±Ù‰
            else if(ext === 'pdf') {
                content = `<iframe src="${url}"></iframe>`;
            } 
            else {
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¹Ø§Ø±Ø¶ Ø¬ÙˆØ¬Ù„ Ù„Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù†ØµÙŠØ© ÙˆØºÙŠØ±Ù‡Ø§
                content = `<iframe src="https://docs.google.com/gview?url=${encodeURIComponent(url)}&embedded=true"></iframe>`;
            }
            
            setTimeout(() => viewer.innerHTML = content, 200);
        }

        // --- Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª (Upload, Delete, Rename) ---
        async function handleFileUpload(input) {
            const file = input.files[0];
            if(!file) return;

            // Ø·Ù„Ø¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù„Ø¯ Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            const folderName = prompt("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù„Ø¯ (Ù…Ø«Ø§Ù„: Ø£ÙˆÙ„ Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ):", "Ù…Ù„ÙØ§Øª Ø¹Ø§Ù…Ø©");
            if(!folderName) return;

            const finalName = `[${folderName}] ${file.name}`;
            showLoading(true, "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹...");

            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = async () => {
                const content = reader.result.split(',')[1];
                try {
                    await githubApiRequest('PUT', finalName, {
                        message: `Upload ${finalName}`,
                        content: content
                    });
                    showLoading(false);
                    fetchFiles();
                } catch(e) {
                    alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø±ÙØ¹: " + e.message);
                    showLoading(false);
                }
            };
        }

        async function deleteFile(name, sha) {
            if(!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…Ù„Ù:\n${name}ØŸ`)) return;
            showLoading(true, "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­Ø°Ù...");
            try {
                await githubApiRequest('DELETE', name, {
                    message: `Delete ${name}`,
                    sha: sha
                });
                fetchFiles();
            } catch(e) { alert("Ø®Ø·Ø£: " + e.message); }
            showLoading(false);
        }

        let renameTarget = null;
        function openRename(name, sha) {
            renameTarget = { name, sha };
            document.getElementById('renameInput').value = name;
            document.getElementById('renameModal').style.display = 'block';
        }

        async function confirmRename() {
            const newName = document.getElementById('renameInput').value;
            if(!newName || newName === renameTarget.name) return;
            
            showLoading(true, "Ø¬Ø§Ø±ÙŠ ØªØºÙŠÙŠØ± Ø§Ù„Ø§Ø³Ù…...");
            try {
                // 1. Get content of old file
                const oldFileRes = await fetch(`https://api.github.com/repos/${CONFIG.username}/${CONFIG.repo}/contents/${CONFIG.path}/${renameTarget.name}`, { headers: getAuthHeader() });
                const oldFileData = await oldFileRes.json();
                
                // 2. Create new file with old content
                await githubApiRequest('PUT', newName, {
                    message: `Rename ${renameTarget.name} to ${newName}`,
                    content: oldFileData.content // Content is already base64
                });

                // 3. Delete old file
                await githubApiRequest('DELETE', renameTarget.name, {
                    message: `Delete old file ${renameTarget.name}`,
                    sha: renameTarget.sha
                });

                closeModal('renameModal');
                fetchFiles();
            } catch(e) { alert("Ø®Ø·Ø£: " + e.message); }
            showLoading(false);
        }

        // --- Ø£Ø¯ÙˆØ§Øª Ù…Ø³Ø§Ø¹Ø¯Ø© ---
        async function githubApiRequest(method, filename, body) {
            const res = await fetch(`https://api.github.com/repos/${CONFIG.username}/${CONFIG.repo}/contents/${CONFIG.path}/${encodeURIComponent(filename)}`, {
                method: method,
                headers: { ...getAuthHeader(), 'Content-Type': 'application/json' },
                body: JSON.stringify({ ...body, branch: CONFIG.branch })
            });
            if(!res.ok) throw new Error(await res.text());
            return res.json();
        }

        function getFileIcon(name) {
            const ext = name.split('.').pop().toLowerCase();
            if(ext === 'pdf') return 'fa-solid fa-file-pdf text-red-500';
            if(['doc','docx'].includes(ext)) return 'fa-solid fa-file-word text-blue-500';
            if(['xls','xlsx'].includes(ext)) return 'fa-solid fa-file-excel text-green-500';
            if(['jpg','png'].includes(ext)) return 'fa-solid fa-file-image text-purple-500';
            return 'fa-solid fa-file text-gray-400';
        }

        function filterFiles(text) { renderTree(allFiles, text); }
        function refreshFiles() { fetchFiles(); }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
        function showLoading(show, text) { 
            document.getElementById('loadingModal').style.display = show ? 'block' : 'none'; 
            if(text) document.getElementById('loadingText').innerText = text;
        }
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
        }
    </script>
</body>
</html>
